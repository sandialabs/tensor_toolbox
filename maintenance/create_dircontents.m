function C = create_dircontents(dirname)% Scan a directory and create a contents list.%%%fprintf('\nReading the contents of directory %s.\n',dirname);D = dir(dirname);if (numel(D) == 0)    error('ERROR: Running in wrong directory!');end%% Find the m-files%fprintf('\nFinding the m-files.\n');cnt = 0;for i = 1:numel(D)    foo = D(i).name;    if regexp(foo,'.*.m$') ...            & ~(~(isequal(foo(1:min(end,10)), 'tt_ind2sub') ...                  || isequal(foo(1:min(end,10)), 'tt_sub2ind'))...                & isequal(foo(1:min(end,3)),'tt_')) ...            & ~isequal(foo(1:min(end,4)),'tmp_') ...            & ~isequal(foo(1:min(end,8)),'Contents')%        fprintf('M-File: %s\n', foo);        cnt = cnt+1;        F{cnt} = foo;    endend%% Extract the descriptions%fprintf('\nExtracing the M-file descriptions.\n');for i = 1:cnt    % Open file    fname = sprintf('%s/%s',dirname,F{i});    fid = fopen(fname);    if (fid == -1)        error('Unable to open file');    end    % Find function declaration    while 1        tline = fgetl(fid);        if regexp(tline,'^function.*')            break;        end    end    % Find title line    while 1        tline = fgetl(fid);        if tline == -1            break        end        if regexp(tline,'^%.*')            foo = regexp(tline,'%([A-Z_0-9]*)\s*(.*)','tokens');            name{i} = lower(foo{1}{1});            desc{i} = foo{1}{2};                        if ~isequal(name{i},F{i}(1:end-2))                warning('Filename/description mismatch for %s', [dirname '/' F{i}]);            elseif isempty(regexp(desc{i},'\.\s*$'))                warning('Missing final period for description in %s',[dirname '/' F{i}]);            end                        break;        end    end    % Find copyright    c = 0;    while 1       fline = fgetl(fid);       if ~ischar(fline), break, end       if strcmp(fline,'%Copyright 2015, Sandia Corporation.') || ...               strcmp(fline,'%Copyright 2017, Sandia Corporation.')           c = 2;           break;       elseif strcmp(fline,'%Copyright 2012, Sandia Corporation.')           c = 1;           break;       end    end    if strfind(dirname,'met')       %fprintf('Not worrying about copyright in %s!\n',[dirname '/' F{i}]);    elseif c == 0        warning('Missing copyright in %s',[dirname '/' F{i}]);    elseif c == 1        warning('Copyright out of date in %s',[dirname '/' F{i}]);    end        fclose(fid);        end%% Clean up contents linesw =  max(cellfun(@length,name));pat = sprintf('%%-%ds - %%s',w);for i = 1:cnt    C{i} = sprintf(pat,name{i},desc{i});%    fprintf('Descp for %-30s: %s\n',F{i},C{i});end